services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: tanglish-tts-backend
    environment:
      APP_ENV: ${APP_ENV:-development}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:5173,http://127.0.0.1:5173}
      MODEL_TIMEOUT_SECONDS: ${MODEL_TIMEOUT_SECONDS:-45}
      MAX_CONCURRENT_SYNTH: ${MAX_CONCURRENT_SYNTH:-6}
      REQUEST_TIMEOUT_SECONDS: ${REQUEST_TIMEOUT_SECONDS:-35}
      PUBLIC_AUDIO_BASE_URL: ${PUBLIC_AUDIO_BASE_URL:-http://localhost:8000}
      AUDIO_STORE_DIR: ${AUDIO_STORE_DIR:-/tmp/tanglish_tts_audio}
      SARVAM_API_KEY: ${SARVAM_API_KEY:-}
      SARVAM_BASE_URL: ${SARVAM_BASE_URL:-https://api.sarvam.ai}
      GOOGLE_APPLICATION_CREDENTIALS: ${GOOGLE_APPLICATION_CREDENTIALS:-}
      GOOGLE_TTS_PROJECT_ID: ${GOOGLE_TTS_PROJECT_ID:-}
      AZURE_SPEECH_KEY: ${AZURE_SPEECH_KEY:-}
      AZURE_SPEECH_REGION: ${AZURE_SPEECH_REGION:-}
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:-}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY:-}
      AWS_SESSION_TOKEN: ${AWS_SESSION_TOKEN:-}
      AWS_REGION: ${AWS_REGION:-ap-south-1}
      ELEVENLABS_API_KEY: ${ELEVENLABS_API_KEY:-}
      ELEVENLABS_BASE_URL: ${ELEVENLABS_BASE_URL:-https://api.elevenlabs.io}
      ELEVENLABS_ADAM_VOICE_ID: ${ELEVENLABS_ADAM_VOICE_ID:-pNInz6obpgDQGcFmaJgB}
      ELEVENLABS_MODEL_ID: ${ELEVENLABS_MODEL_ID:-eleven_multilingual_v2}
      HF_TOKEN: ${HF_TOKEN:-}
      HF_HOME: ${HF_HOME:-}
      HF_CACHE_DIR: ${HF_CACHE_DIR:-}
      LOCAL_DEVICE: ${LOCAL_DEVICE:-cpu}
      LOCAL_DTYPE: ${LOCAL_DTYPE:-float32}
      LOCAL_MODEL_WARMUP: ${LOCAL_MODEL_WARMUP:-false}
      LOCAL_MODEL_TIMEOUT_SECONDS: ${LOCAL_MODEL_TIMEOUT_SECONDS:-900}
      HF_ALIAS_MAYA_RESEARCH_VEENA_ALL_V1: ${HF_ALIAS_MAYA_RESEARCH_VEENA_ALL_V1:-maya-research/Veena}
    ports:
      - "8000:8000"
    volumes:
      - backend_audio_data:/tmp/tanglish_tts_audio
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_BACKEND_BASE_URL: ${VITE_BACKEND_BASE_URL:-http://localhost:8000}
    container_name: tanglish-tts-frontend
    depends_on:
      - backend
    ports:
      - "5173:80"
    restart: unless-stopped

volumes:
  backend_audio_data:
